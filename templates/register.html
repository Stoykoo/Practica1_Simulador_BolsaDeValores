{% extends "layout.html" %}
{% block content %}
<div class="auth-container">
    <div class="auth-card fade-in">
        <!-- Header del Registro -->
        <div class="auth-header">
            <div class="auth-icon">
                <i class="bi bi-person-plus"></i>
            </div>
            <h1 class="auth-title">Comienza tu Viaje</h1>
            <p class="auth-subtitle">Crea tu cuenta y toma el control de tus inversiones</p>
        </div>

        <!-- Formulario -->
        <form method="POST" action="" class="auth-form">
            {{ form.hidden_tag() }}
            
            <!-- Username -->
            <div class="form-group">
                <div class="input-group">
                    <i class="bi bi-person input-icon"></i>
                    {{ form.username(class="form-input", placeholder=" ") }}
                    {{ form.username.label(class="form-label") }}
                </div>
                {% if form.username.errors %}
                    <div class="error-message">
                        {% for error in form.username.errors %}
                            <i class="bi bi-exclamation-circle"></i> {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <!-- Email -->
            <div class="form-group">
                <div class="input-group">
                    <i class="bi bi-envelope input-icon"></i>
                    {{ form.email(class="form-input", placeholder=" ") }}
                    {{ form.email.label(class="form-label") }}
                </div>
                {% if form.email.errors %}
                    <div class="error-message">
                        {% for error in form.email.errors %}
                            <i class="bi bi-exclamation-circle"></i> {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <!-- Password -->
            <div class="form-group">
                <div class="input-group">
                    <i class="bi bi-lock input-icon"></i>
                    {{ form.password(class="form-input", placeholder=" ") }}
                    {{ form.password.label(class="form-label") }}
                    <button type="button" class="password-toggle" data-target="password">
                        <i class="bi bi-eye"></i>
                    </button>
                </div>
                {% if form.password.errors %}
                    <div class="error-message">
                        {% for error in form.password.errors %}
                            <i class="bi bi-exclamation-circle"></i> {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
                
                <!-- Indicador de fortaleza de contraseña -->
                <div class="password-strength">
                    <div class="strength-bar">
                        <div class="strength-fill" id="passwordStrength"></div>
                    </div>
                    <div class="strength-text" id="passwordText">Seguridad de la contraseña</div>
                </div>
            </div>

            <!-- Confirm Password -->
            <div class="form-group">
                <div class="input-group">
                    <i class="bi bi-shield-check input-icon"></i>
                    {{ form.confirm_password(class="form-input", placeholder=" ") }}
                    {{ form.confirm_password.label(class="form-label") }}
                    <button type="button" class="password-toggle" data-target="confirm_password">
                        <i class="bi bi-eye"></i>
                    </button>
                </div>
                {% if form.confirm_password.errors %}
                    <div class="error-message">
                        {% for error in form.confirm_password.errors %}
                            <i class="bi bi-exclamation-circle"></i> {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
                
                <!-- Indicador de coincidencia -->
                <div class="password-match" id="passwordMatch">
                    <i class="bi bi-check-circle-fill"></i>
                    <span>Las contraseñas coinciden</span>
                </div>
            </div>

            <!-- Términos y Condiciones -->
            <div class="form-group">
                <label class="checkbox-container">
                    <input type="checkbox" class="checkbox-input" id="termsCheckbox" required>
                    <span class="checkmark"></span>
                    <span class="checkbox-label">
                        Acepto los <a href="#" class="terms-link">Términos de Servicio</a> y 
                        <a href="#" class="terms-link">Política de Privacidad</a>
                    </span>
                </label>
            </div>

            <!-- Botón de Registro -->
            <div class="form-actions">
                {{ form.submit(class="btn-pill btn-primary btn-full", id="submitBtn", disabled=true) }}
            </div>
        </form>

        <!-- Separador -->
        <div class="auth-divider">
            <span>o regístrate con</span>
        </div>

        <!-- Registro Social -->
        <div class="social-auth">
            <button type="button" class="btn-social google-btn">
                <i class="bi bi-google"></i>
                Google
            </button>
            <button type="button" class="btn-social apple-btn">
                <i class="bi bi-apple"></i>
                Apple
            </button>
        </div>

        <!-- Enlace a Login -->
        <div class="auth-footer">
            <p class="auth-footer-text">
                ¿Ya tienes una cuenta? 
                <a href="{{ url_for('login') }}" class="auth-footer-link">
                    Inicia Sesión
                </a>
            </p>
        </div>
    </div>

    <!-- Ilustración decorativa -->
    <div class="auth-decoration">
        <div class="decoration-content">
            <div class="floating-rocket">
                <i class="bi bi-rocket-takeoff"></i>
            </div>
            <div class="floating-chart">
                <i class="bi bi-graph-up-arrow"></i>
            </div>
            <div class="floating-trophy">
                <i class="bi bi-trophy"></i>
            </div>
            <div class="floating-diamond">
                <i class="bi bi-gem"></i>
            </div>
        </div>
        
        <!-- Beneficios del registro -->
        <div class="benefits-list">
            <div class="benefit-item fade-in">
                <i class="bi bi-lightning-charge benefit-icon"></i>
                <div class="benefit-content">
                    <h4>Análisis en Tiempo Real</h4>
                    <p>Datos de mercado actualizados al instante</p>
                </div>
            </div>
            
            <div class="benefit-item fade-in" style="animation-delay: 0.2s;">
                <i class="bi bi-shield-check benefit-icon"></i>
                <div class="benefit-content">
                    <h4>Seguridad Bancaria</h4>
                    <p>Tus datos protegidos con encriptación avanzada</p>
                </div>
            </div>
            
            <div class="benefit-item fade-in" style="animation-delay: 0.4s;">
                <i class="bi bi-phone benefit-icon"></i>
                <div class="benefit-content">
                    <h4>Multiplataforma</h4>
                    <p>Accede desde cualquier dispositivo</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript para el registro -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('Inicializando formulario de registro...');
    
    const passwordInput = document.querySelector('input[name="password"]');
    const confirmPasswordInput = document.querySelector('input[name="confirm_password"]');
    const termsCheckbox = document.getElementById('termsCheckbox');
    const submitBtn = document.getElementById('submitBtn');
    const passwordStrength = document.getElementById('passwordStrength');
    const passwordText = document.getElementById('passwordText');
    const passwordMatch = document.getElementById('passwordMatch');

    // Toggle de visibilidad de contraseña
    document.querySelectorAll('.password-toggle').forEach(toggle => {
        toggle.addEventListener('click', function() {
            const inputGroup = this.closest('.input-group');
            const input = inputGroup.querySelector('input[type="password"], input[type="text"]');
            
            if (input) {
                const newType = input.type === 'password' ? 'text' : 'password';
                input.type = newType;
                
                const icon = this.querySelector('i');
                if (icon) {
                    icon.className = newType === 'text' ? 'bi bi-eye-slash' : 'bi bi-eye';
                }
                
                // Efecto visual
                this.style.transform = 'scale(0.9)';
                setTimeout(() => {
                    this.style.transform = 'scale(1)';
                }, 150);
            }
        });
    });

    // Verificador de fortaleza de contraseña
    if (passwordInput) {
        passwordInput.addEventListener('input', function() {
            checkPasswordStrength(this.value);
            checkPasswordsMatch();
            updateSubmitButton();
        });
    }

    // Verificador de coincidencia de contraseñas
    if (confirmPasswordInput) {
        confirmPasswordInput.addEventListener('input', function() {
            checkPasswordsMatch();
            updateSubmitButton();
        });
    }

    // Habilitar/deshabilitar botón de envío
    if (termsCheckbox) {
        termsCheckbox.addEventListener('change', updateSubmitButton);
    }

    function checkPasswordStrength(password) {
        let strength = 0;
        let text = '';
        let color = '';

        if (password.length >= 8) strength++;
        if (password.match(/[a-z]+/)) strength++;
        if (password.match(/[A-Z]+/)) strength++;
        if (password.match(/[0-9]+/)) strength++;
        if (password.match(/[!@#$%^&*(),.?":{}|<>]+/)) strength++;

        switch(strength) {
            case 0:
            case 1:
                text = 'Muy Débil';
                color = '#ef4444';
                break;
            case 2:
                text = 'Débil';
                color = '#f59e0b';
                break;
            case 3:
                text = 'Media';
                color = '#eab308';
                break;
            case 4:
                text = 'Fuerte';
                color = '#10b981';
                break;
            case 5:
                text = 'Muy Fuerte';
                color = '#059669';
                break;
        }

        if (passwordStrength) {
            passwordStrength.style.width = `${(strength / 5) * 100}%`;
            passwordStrength.style.background = color;
        }

        if (passwordText) {
            passwordText.textContent = text;
            passwordText.style.color = color;
        }
    }

    function checkPasswordsMatch() {
        const password = passwordInput ? passwordInput.value : '';
        const confirmPassword = confirmPasswordInput ? confirmPasswordInput.value : '';
        
        if (passwordMatch) {
            if (confirmPassword && password === confirmPassword) {
                passwordMatch.style.display = 'flex';
                passwordMatch.innerHTML = '<i class="bi bi-check-circle-fill"></i><span>Las contraseñas coinciden</span>';
                passwordMatch.style.color = '#10b981';
            } else if (confirmPassword) {
                passwordMatch.style.display = 'flex';
                passwordMatch.innerHTML = '<i class="bi bi-x-circle-fill"></i><span>Las contraseñas no coinciden</span>';
                passwordMatch.style.color = '#ef4444';
            } else {
                passwordMatch.style.display = 'none';
            }
        }
    }

    function updateSubmitButton() {
        const password = passwordInput ? passwordInput.value : '';
        const confirmPassword = confirmPasswordInput ? confirmPasswordInput.value : '';
        const termsAccepted = termsCheckbox ? termsCheckbox.checked : false;
        
        const isFormValid = password.length >= 6 && 
                           password === confirmPassword && 
                           termsAccepted;

        if (submitBtn) {
            submitBtn.disabled = !isFormValid;
        }
    }

    // Efectos de focus en inputs
    const inputs = document.querySelectorAll('.form-input');
    inputs.forEach(input => {
        input.addEventListener('focus', function() {
            this.parentElement.classList.add('focused');
        });
        
        input.addEventListener('blur', function() {
            if (this.value === '') {
                this.parentElement.classList.remove('focused');
            }
        });

        // Verificar estado inicial
        if (input.value !== '') {
            input.parentElement.classList.add('focused');
        }
    });

    // Animación de entrada para beneficios
    const benefitItems = document.querySelectorAll('.benefit-item');
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.animationPlayState = 'running';
            }
        });
    }, { threshold: 0.1 });

    benefitItems.forEach(item => observer.observe(item));
    
    console.log('Formulario de registro inicializado correctamente');
});
</script>
{% endblock content %}